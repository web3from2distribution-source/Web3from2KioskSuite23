<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web 2.5 Kiosk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* General body styling to match the image's primary colors */
        body {
            font-family: 'Courier New', monospace; /* A classic retro font style */
            background-color: #1A1E26; /* Dark slate background */
            color: #F5EEDF; /* Off-white text to match the board */
            background-image: repeating-linear-gradient(0deg, #1A1E26, #1A1E26 1px, #20242C 1px, #20242C 2px); /* Subtle scanline effect */
        }
        /* Main container styling */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            border: 4px solid #000000; /* Thick border like the gameboard */
            box-shadow: 8px 8px 0px #000;
            background-color: #84A28B; /* Main board color */
        }
        /* Special styling for the start page panel */
        #start-page .container {
            background-color: #496A6F; /* Darker teal/blue color */
        }
        /* Kiosk menu item card styling */
        .menu-item-card {
            background-color: #F5EEDF; /* Beige background for cards */
            border: 2px solid #000;
            box-shadow: 4px 4px 0px #000;
            color: #1A1E26;
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }
        .menu-item-card:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 0px #000;
        }
        .menu-item-card img {
            border-bottom: 2px solid #000;
        }
        /* Modal and modal content styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(26, 30, 38, 0.9);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #496A6F;
            border: 2px solid #000;
            box-shadow: 6px 6px 0px #000;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 2rem;
            font-weight: bold;
            color: #DE4940;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover {
            color: #FF5C5C;
        }
        /* Button styling */
        .action-button {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-shadow: 2px 2px #000000;
            border: 2px solid #000000;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .action-button:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #000, inset 2px 2px #000;
        }
        .btn-blue {
            background-color: #496A6F; /* Teal/blue from image */
            box-shadow: 2px 2px 0px #000;
            color: #F5EEDF;
        }
        .btn-blue:hover {
            background-color: #3A5B60;
            box-shadow: 4px 4px 0px #000;
        }
        .btn-green {
            background-color: #84A28B; /* Green from image */
            box-shadow: 2px 2px 0px #000;
            color: #1A1E26;
        }
        .btn-green:hover {
            background-color: #74927A;
            box-shadow: 4px 4px 0px #000;
        }
        .btn-red {
            background-color: #DE4940; /* Red from image */
            box-shadow: 2px 2px 0px #000;
            color: #F5EEDF;
        }
        .btn-red:hover {
            background-color: #BF3B33;
            box-shadow: 4px 4px 0px #000;
        }
        .btn-purple {
            background-color: #9c27b0;
            box-shadow: 2px 2px 0px #000;
            color: #F5EEDF;
        }
        .btn-purple:hover {
            background-color: #8c20a0;
            box-shadow: 4px 4px 0px #000;
        }
        .btn-orange {
            background-color: #ff9800;
            box-shadow: 2px 2px 0px #000;
            color: #F5EEDF;
        }
        .btn-orange:hover {
            background-color: #e68a00;
            box-shadow: 4px 4px 0px #000;
        }
        .btn-gray {
            background-color: #718096;
            box-shadow: 2px 2px 0px #000;
            color: #F5EEDF;
        }
        .btn-gray:hover {
            background-color: #617081;
            box-shadow: 4px 4px 0px #000;
        }
        /* Back button styling */
        .back-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background-color: #496A6F;
            color: #F5EEDF;
            border: 2px solid #000;
            box-shadow: 2px 2px 0px #000;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
            z-index: 10;
        }
        .back-btn:hover {
            background-color: #3A5B60;
        }
        /* Admin dashboard column styling */
        .admin-column {
            background-color: #496A6F;
            border: 2px solid #000;
            box-shadow: inset 4px 4px 0px #222;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .admin-column h3 {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFE84C; /* Yellow from image */
            border-bottom: 2px solid #000;
            padding-bottom: 0.75rem;
            margin-bottom: 1rem;
        }
        /* Admin order card styling */
        .admin-order-card {
            background-color: #F5EEDF;
            border: 2px solid #000;
            padding: 1rem;
            box-shadow: 2px 2px 0px #000;
            color: #1A1E26;
        }
        .admin-order-card .order-items-list {
            list-style: none;
            padding-left: 0;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #1A1E26;
        }
        .admin-order-card .order-items-list li {
            margin-bottom: 0.25rem;
        }
        /* Admin button styling for statuses */
        .admin-order-card .status-buttons button {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border: 2px solid #000;
            font-weight: bold;
            transition: background-color 0.2s;
            text-shadow: none;
            box-shadow: 2px 2px 0px #000;
            color: #1A1E26;
        }
        .admin-order-card .status-buttons button:hover {
            box-shadow: 4px 4px 0px #000;
        }
        .admin-order-card .status-buttons button:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #000, inset 2px 2px #000;
        }

        .admin-order-card .status-buttons .btn-in-progress {
            background-color: #FFE84C; /* Yellow */
        }
        .admin-order-card .status-buttons .btn-in-progress:hover {
            background-color: #EDD83A;
        }
        .admin-order-card .status-buttons .btn-completed {
            background-color: #84A28B; /* Green */
        }
        .admin-order-card .status-buttons .btn-completed:hover {
            background-color: #74927A;
        }
        .admin-order-card .status-buttons .btn-revert {
            background-color: #F5EEDF; /* Off-white */
        }
        .admin-order-card .status-buttons .btn-revert:hover {
            background-color: #DDD4CC;
        }
        /* Input styling */
        input[type="text"], input[type="url"], input[type="number"], input[type="password"], textarea, select {
            background-color: #F5EEDF;
            border: 2px solid #000;
            box-shadow: inset 2px 2px 0px #1A1E26;
            color: #1A1E26;
            font-family: 'Courier New', monospace;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: inset 2px 2px 0px #1A1E26, 0 0 0 2px #FFE84C;
        }
        /* Text colors */
        .text-yellow-400 { color: #FFE84C; text-shadow: 2px 2px #000; }
        .text-indigo-400 { color: #496A6F; text-shadow: 2px 2px #000; }
        .text-green-400 { color: #84A28B; text-shadow: 2px 2px #000; }
        .text-purple-400 { color: #DE4940; text-shadow: 2px 2px #000; }
        .text-red-400 { color: #DE4940; text-shadow: 2px 2px #000; }
        .text-gray-300 { color: #1A1E26; }
        .text-gray-400 { color: #496A6F; }
        .text-gray-500 { color: #496A6F; }
        .text-white { color: #F5EEDF; }
        .text-black { color: #1A1E26; }
        .provider-checkbox-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
            border: 2px solid #000;
            padding: 10px;
            background-color: #E6E1D8;
        }
        .provider-checkbox-container label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex items-center justify-center">

    <div id="app-container" class="min-h-screen w-full flex flex-col">

        <div id="start-page" class="flex-1 flex flex-col items-center justify-center text-center p-4">
            <div class="container text-center p-8 bg-gray-800 max-w-lg mx-auto">
                <h1 id="start-page-title" class="text-5xl font-extrabold text-yellow-400 mb-8">Welcome to The Web 2.5 Kiosk!</h1>
                <p class="text-gray-300 text-xl mb-10">Please choose your role to continue:</p>
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-6 justify-center">
                    <button id="show-kiosk-btn" class="px-8 py-4 btn-blue action-button text-lg">
                        <i class="fas fa-utensils mr-2"></i> Customer Kiosk
                    </button>
                    <button id="show-admin-btn" class="px-8 py-4 btn-purple action-button text-lg">
                        <i class="fas fa-user-shield mr-2"></i> Admin Dashboard
                    </button>
                    <button id="connect-metamask-btn" class="px-8 py-4 btn-orange action-button text-lg">
                        <i class="fas fa-wallet mr-2"></i> Connect MetaMask
                    </button>
                </div>
            </div>
        </div>

        <div id="food-kiosk-page" class="flex-1 hidden relative">
            <button id="back-to-start-kiosk-btn" class="back-btn"><i class="fas fa-arrow-left mr-2"></i> Back to Start</button>
            <header class="py-6 shadow-lg" style="background-color: #496A6F; border-bottom: 2px solid #000; box-shadow: 0 4px 0px #000;">
                <div class="container text-center" style="border: none; box-shadow: none; background-color: transparent;">
                    <h1 id="kiosk-title" class="text-4xl font-extrabold text-yellow-400">My Web 2.5 Kiosk</h1>
                    <p id="kiosk-tagline" class="text-gray-400 text-lg mt-2">Decentralized E-commerce!</p>
                </div>
            </header>
            <main class="container mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <section class="lg:col-span-2">
                    <h2 id="kiosk-menu-title" class="text-3xl font-bold text-indigo-400 mb-6 text-center lg:text-left">Our Delicious Menu</h2>
                    
                    <div class="p-4 rounded-xl shadow-lg mb-6" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h3 class="text-xl font-bold text-gray-300 mb-2" style="color: #F5EEDF;">Have a Product Link?</h3>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="url" id="product-link-input" placeholder="Paste a product link here..." class="flex-1 p-2">
                            <button id="load-product-link-btn" class="px-4 py-2 btn-blue action-button">
                                Load Product
                            </button>
                        </div>
                        <p id="product-link-message" class="text-red-400 text-sm mt-2 hidden"></p>
                    </div>
                    
                    <div id="menu-items-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>
                </section>
                <aside class="lg:col-span-1 p-6 shadow-lg h-fit sticky top-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                    <h2 class="text-3xl font-bold text-green-400 mb-6 text-center">Your Order</h2>
                    <div id="order-list" class="space-y-4 mb-6 min-h-[100px]">
                        <p id="empty-cart-message" class="text-gray-500 text-center">Your cart is empty. Add some delicious items!</p>
                    </div>
                    <div class="border-t pt-4 mt-4" style="border-top: 2px solid #000;">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xl font-bold text-black">Total:</span>
                            <span id="order-total" class="text-3xl font-extrabold text-yellow-400">$0.00</span>
                        </div>
                        <button id="complete-order-btn" class="w-full py-3 btn-green action-button disabled:opacity-50 disabled:cursor-not-allowed">
                            Complete Order
                        </button>
                    </div>
                </aside>
            </main>
            
            <div id="permanent-payment-providers-container" class="container mt-8 p-6 shadow-lg">
                <h2 class="text-3xl font-bold text-yellow-400 mb-6 text-center">Permanent Payment Options</h2>
                <div id="permanent-providers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </div>

            <footer class="py-6 mt-auto text-center text-gray-400" style="background-color: #496A6F; border-top: 2px solid #000; color: #F5EEDF;">
                <p>&copy; 2025 The Food Spot. All rights reserved.</p>
            </footer>
        </div>
        
        <div id="order-menu-page" class="hidden flex-1 flex flex-col items-center justify-center p-4">
            <div class="container text-center p-8 max-w-lg mx-auto" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 6px 6px 0px #000;">
                <h1 class="text-4xl font-extrabold text-yellow-400 mb-4">Order Placed!</h1>
                <p class="text-xl text-gray-300 mb-6" style="color: #F5EEDF;">Your order has been sent for processing. Please take your transaction number below and use one of the permanent payment buttons on the main page to pay.</p>
                <div id="transaction-info-container" class="p-4 rounded-xl shadow-lg mb-6 flex flex-col items-center text-center" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: 4px 4px 0px #000; color: #1A1E26;">
                    <h3 class="text-xl font-bold text-black mb-2">Transaction Number:</h3>
                    <div class="flex items-center gap-4">
                        <span id="transaction-number" class="text-xl font-extrabold text-blue-500"></span>
                        <button id="copy-transaction-btn" class="px-4 py-2 btn-blue action-button text-sm" style="color: #F5EEDF;">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <button id="start-new-order-btn" class="mt-8 px-6 py-3 btn-green action-button">
                    Start a New Order
                </button>
            </div>
        </div>


        <div id="admin-dashboard-page" class="flex-1 hidden flex flex-col p-4">
            <div class="container p-8 w-full mx-auto" style="background-color: #84A28B; border: 2px solid #000; box-shadow: 6px 6px 0px #000;">
                <button id="back-to-start-admin-btn" class="back-btn mb-6"><i class="fas fa-arrow-left mr-2"></i> Back to Start</button>
                <h1 class="text-4xl font-extrabold text-purple-400 mb-6 text-center">Admin Dashboard</h1>
                
                <div id="admin-login-section" class="text-center mb-8">
                    <p class="text-gray-300 text-lg mb-4" style="color: #1A1E26;">Enter PIN to access the Admin Dashboard:</p>
                    <input type="password" id="admin-pin-input" class="w-full max-w-xs p-3 text-center mb-4" placeholder="15-digit PIN">
                    <button id="admin-login-submit-btn" class="px-6 py-3 btn-purple action-button">
                        Login
                    </button>
                    <p id="admin-login-message" class="text-red-400 mt-4 hidden">Incorrect PIN. Please try again.</p>
                </div>

                <div id="admin-dashboard-content" class="hidden">

                    <div class="p-6 shadow-lg mb-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">Store Text Management</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="store-title-input" class="block text-sm font-medium text-gray-400 mb-1" style="color: #F5EEDF;">Store Title</label>
                                <input type="text" id="store-title-input" class="w-full p-2" placeholder="e.g., The Food Spot">
                            </div>
                            <div>
                                <label for="store-tagline-input" class="block text-sm font-medium text-gray-400 mb-1" style="color: #F5EEDF;">Tagline</label>
                                <input type="text" id="store-tagline-input" class="w-full p-2" placeholder="e.g., Fresh, Fast, Delicious!">
                            </div>
                            <div>
                                <label for="menu-title-input" class="block text-sm font-medium text-gray-400 mb-1" style="color: #F5EEDF;">Menu Title</label>
                                <input type="text" id="menu-title-input" class="w-full p-2" placeholder="e.g., Our Delicious Menu">
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 shadow-lg mb-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">Menu Management</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-4" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;">
                                <h3 id="item-form-title" class="text-xl font-bold mb-3 text-center border-b pb-2" style="color: #1A1E26; border-bottom: 2px solid #000;">Add New Menu Item</h3>
                                <div class="space-y-4">
                                    <input type="text" id="item-id" class="hidden">
                                    <input type="text" id="item-name" placeholder="Item Name" class="w-full p-2" required>
                                    <input type="number" id="item-price" placeholder="Price (e.g., 9.99)" step="0.01" min="0" class="w-full p-2" required>
                                    <textarea id="item-description" placeholder="Description" rows="3" class="w-full p-2" required></textarea>
                                    
                                    <div class="space-y-2">
                                        <label for="item-image-url" class="block text-xs font-medium text-gray-400 mb-1" style="color: #1A1E26;">Enter an image URL:</label>
                                        <input type="url" id="item-image-url" placeholder="e.g., https://placehold.co/..." class="w-full p-2">
                                    </div>
                                    <div id="image-preview" class="mt-4 hidden">
                                        <img src="" class="max-w-full h-auto shadow-md mx-auto" alt="Image Preview" style="border: 2px solid #000; box-shadow: 2px 2px 0px #000;" >
                                    </div>
                                    
                                    <div class="flex gap-2">
                                        <button id="save-item-btn" class="w-full py-3 btn-green action-button">
                                            <i class="fas fa-plus mr-2"></i> Add Item
                                        </button>
                                        <button id="cancel-edit-btn" class="w-full py-3 btn-gray action-button hidden">
                                            Cancel
                                        </button>
                                    </div>
                                    <p id="item-form-message" class="text-center text-red-400 hidden"></p>
                                </div>
                            </div>

                            <div class="p-4" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;">
                                <h3 class="text-xl font-bold mb-3 text-center border-b pb-2" style="color: #1A1E26; border-bottom: 2px solid #000;">Current Menu Items</h3>
                                <div id="admin-menu-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                                    <p id="no-menu-items-message" class="text-gray-400 text-sm text-center" style="color: #496A6F;">No menu items added yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 shadow-lg mb-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">Shareable Product Links</h2>
                        <div id="product-link-generation-container" class="space-y-4">
                            </div>
                    </div>

                    <div class="p-6 shadow-lg mb-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">Payment Provider Management</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-4" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;">
                                <h3 class="text-xl font-bold mb-3 text-center border-b pb-2" style="color: #1A1E26; border-bottom: 2px solid #000;">Add New Provider</h3>
                                <div class="space-y-4">
                                    <input type="text" id="provider-name" placeholder="Provider Name (e.g., Stripe, PayPal)" class="w-full p-2" required>
                                    <input type="url" id="provider-link" placeholder="Payment Link (e.g., https://stripe.com/...)" class="w-full p-2" required>
                                    <div class="flex gap-2">
                                        <button id="add-provider-btn" class="w-full py-3 btn-blue action-button">
                                            <i class="fas fa-user-plus mr-2"></i> Add Provider
                                        </button>
                                    </div>
                                    <p id="provider-form-message" class="text-center text-red-400 hidden"></p>
                                </div>
                            </div>

                            <div class="p-4" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;">
                                <h3 class="text-xl font-bold mb-3 text-center border-b pb-2" style="color: #1A1E26; border-bottom: 2px solid #000;">Current Payment Providers</h3>
                                <div id="providers-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                                    <p id="no-providers-message" class="text-gray-400 text-sm text-center" style="color: #496A6F;">No providers added yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 shadow-lg mb-8" style="background-color: #496A6F; border: 2px solid #000; box-shadow: 4px 4px 0px #000;">
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">Admin PIN Management</h2>
                        <div class="space-y-4 text-black" style="background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; padding: 1.5rem;">
                            <p class="text-sm font-medium text-center">To change the PIN, please enter your current PIN, followed by a new 15-digit PIN.</p>
                            <div class="space-y-2">
                                <label for="current-pin-input" class="block text-sm font-medium text-gray-400" style="color: #1A1E26;">Current PIN</label>
                                <input type="password" id="current-pin-input" class="w-full p-2" placeholder="Current 15-digit PIN">
                            </div>
                            <div class="space-y-2">
                                <label for="new-pin-input" class="block text-sm font-medium text-gray-400" style="color: #1A1E26;">New PIN</label>
                                <input type="password" id="new-pin-input" class="w-full p-2" placeholder="New 15-digit PIN">
                            </div>
                            <div class="space-y-2">
                                <label for="confirm-new-pin-input" class="block text-sm font-medium text-gray-400" style="color: #1A1E26;">Confirm New PIN</label>
                                <input type="password" id="confirm-new-pin-input" class="w-full p-2" placeholder="Confirm New 15-digit PIN">
                            </div>
                            <button id="update-pin-btn" class="w-full py-3 btn-purple action-button">
                                <i class="fas fa-lock mr-2"></i> Update PIN
                            </button>
                            <p id="pin-message" class="text-center text-red-400 hidden"></p>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h2 class="text-3xl font-bold text-green-400 mb-4">Order Status Overview</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="admin-column">
                                <h3>Pending Payments</h3>
                                <div id="new-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                                    <p class="text-gray-500 text-center text-sm" id="no-new-orders">No new orders.</p>
                                </div>
                            </div>
                            <div class="admin-column">
                                <h3>Orders In Progress</h3>
                                <div id="in-progress-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                                    <p class="text-gray-500 text-center text-sm" id="no-in-progress-orders">No orders in progress.</p>
                                </div>
                            </div>
                            <div class="admin-column">
                                <h3>Completed/Delivered Orders</h3>
                                <div id="completed-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                                    <p class="text-gray-500 text-center text-sm" id="no-completed-orders">No completed orders.</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-between gap-4 mt-6 border-b pb-6 mb-6" style="border-bottom: 2px solid #000;">
                            <button id="clear-orders-btn" class="w-full sm:w-1/2 py-3 btn-red action-button">
                                <i class="fas fa-trash-alt mr-2"></i> Clear All Orders
                            </button>
                            <button id="save-completed-orders-btn" class="w-full sm:w-1/2 py-3 action-button" style="background-color: #496A6F; color: #F5EEDF; box-shadow: 2px 2px 0px #000;">
                                <i class="fas fa-save mr-2"></i> Save Completed Orders to Clipboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="confirmationModal" class="modal">
            <div class="modal-content text-center">
                <span class="close-button">&times;</span>
                <p class="text-xl font-bold mb-4" style="color: #F5EEDF;">Are you sure you want to clear all orders?</p>
                <div class="flex justify-center gap-4 mt-4">
                    <button id="confirmYesBtn" class="px-6 py-2 btn-red action-button">Yes</button>
                    <button id="confirmNoBtn" class="px-6 py-2 btn-gray action-button">No</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const showKioskBtn = document.getElementById('show-kiosk-btn');
            const showAdminBtn = document.getElementById('show-admin-btn');
            const startPage = document.getElementById('start-page');
            const foodKioskPage = document.getElementById('food-kiosk-page');
            const orderMenuPage = document.getElementById('order-menu-page');
            const adminDashboardPage = document.getElementById('admin-dashboard-page');
            const backToStartKioskBtn = document.getElementById('back-to-start-kiosk-btn');
            const backToStartAdminBtn = document.getElementById('back-to-start-admin-btn');

            const menuItemsContainer = document.getElementById('menu-items-container');
            const orderList = document.getElementById('order-list');
            const orderTotalSpan = document.getElementById('order-total');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const completeOrderBtn = document.getElementById('complete-order-btn');
            const startNewOrderBtn = document.getElementById('start-new-order-btn');

            const adminPinInput = document.getElementById('admin-pin-input');
            const adminLoginSubmitBtn = document.getElementById('admin-login-submit-btn');
            const adminLoginMessage = document.getElementById('admin-login-message');
            const adminDashboardContent = document.getElementById('admin-dashboard-content');
            
            const newOrdersListAdmin = document.getElementById('new-orders-list-admin');
            const inProgressOrdersListAdmin = document.getElementById('in-progress-orders-list-admin');
            const completedOrdersListAdmin = document.getElementById('completed-orders-list-admin');
            const noNewOrders = document.getElementById('no-new-orders');
            const noInProgressOrders = document.getElementById('no-in-progress-orders');
            const noCompletedOrders = document.getElementById('no-completed-orders');
            const clearOrdersBtn = document.getElementById('clear-orders-btn');
            const saveCompletedOrdersBtn = document.getElementById('save-completed-orders-btn');
            const confirmationModal = document.getElementById('confirmationModal');
            const confirmYesBtn = document.getElementById('confirmYesBtn');
            const confirmNoBtn = document.getElementById('confirmNoBtn');
            const closeConfirmModal = confirmationModal.querySelector('.close-button');
            
            // PIN management elements
            const currentPinInput = document.getElementById('current-pin-input');
            const newPinInput = document.getElementById('new-pin-input');
            const confirmNewPinInput = document.getElementById('confirm-new-pin-input');
            const updatePinBtn = document.getElementById('update-pin-btn');
            const pinMessage = document.getElementById('pin-message');

            // Admin: Menu Management
            const itemFormTitle = document.getElementById('item-form-title');
            const itemIdInput = document.getElementById('item-id');
            const itemNameInput = document.getElementById('item-name');
            const itemPriceInput = document.getElementById('item-price');
            const itemDescriptionInput = document.getElementById('item-description');
            const itemImageUrlInput = document.getElementById('item-image-url');
            const itemProvidersCheckboxContainer = document.getElementById('item-providers-container');
            const imagePreview = document.getElementById('image-preview');
            const saveItemBtn = document.getElementById('save-item-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const itemFormMessage = document.getElementById('item-form-message');
            const adminMenuList = document.getElementById('admin-menu-list');
            const noMenuItemsMessage = document.getElementById('no-menu-items-message');
            
            // Admin: Product Link Generation & Kiosk Link Input
            const productLinkGenerationContainer = document.getElementById('product-link-generation-container');
            const productLinkInput = document.getElementById('product-link-input');
            const loadProductLinkBtn = document.getElementById('load-product-link-btn');
            const productLinkMessage = document.getElementById('product-link-message');

            // Admin: Store Text Management
            const storeTitleInput = document.getElementById('store-title-input');
            const storeTaglineInput = document.getElementById('store-tagline-input');
            const menuTitleInput = document.getElementById('menu-title-input');
            const startPageTitle = document.getElementById('start-page-title');
            const kioskTitle = document.getElementById('kiosk-title');
            const kioskTagline = document.getElementById('kiosk-tagline');
            const kioskMenuTitle = document.getElementById('kiosk-menu-title');

            // Admin: Provider Management
            const providerNameInput = document.getElementById('provider-name');
            const providerLinkInput = document.getElementById('provider-link');
            const addProviderBtn = document.getElementById('add-provider-btn');
            const providersList = document.getElementById('providers-list');
            const providerFormMessage = document.getElementById('provider-form-message');
            const noProvidersMessage = document.getElementById('no-providers-message');
            
            // Permanent Payment Buttons on Customer Page
            const permanentProvidersList = document.getElementById('permanent-providers-list');

            // MetaMask button
            const connectMetamaskBtn = document.getElementById('connect-metamask-btn');
            
            // Transaction number elements
            const transactionNumberSpan = document.getElementById('transaction-number');
            const copyTransactionBtn = document.getElementById('copy-transaction-btn');


            let currentOrder = [];
            const ADMIN_PIN = "atzinp0kt8l4976"; // 15-digit PIN

            // State variables for dynamic content
            let menuItems = [];
            let providers = [];

            // Helper Functions
            function showPage(pageId) {
                const pages = ['start-page', 'food-kiosk-page', 'admin-dashboard-page', 'order-menu-page'];
                pages.forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                document.getElementById(pageId).classList.remove('hidden');
            }

            function updateKioskText() {
                const storeTitle = localStorage.getItem('storeTitle') || "Web 2.5 Kiosk";
                const tagline = localStorage.getItem('storeTagline') || "Decentralized E-commerce!";
                const menuTitle = localStorage.getItem('menuTitle') || "Our Delicious Menu";
                
                startPageTitle.textContent = `Welcome to ${storeTitle}!`;
                kioskTitle.textContent = storeTitle;
                kioskTagline.textContent = tagline;
                kioskMenuTitle.textContent = menuTitle;
            }

            function loadMenuItems() {
                const storedMenuItems = JSON.parse(localStorage.getItem('menuItems')) || [];
                menuItems = storedMenuItems;
                renderMenuItems();
                renderAdminMenuItems();
            }

            function saveMenuItems() {
                localStorage.setItem('menuItems', JSON.stringify(menuItems));
                renderMenuItems();
                renderAdminMenuItems();
            }

            function loadProviders() {
                const storedProviders = JSON.parse(localStorage.getItem('paymentProviders')) || [];
                providers = storedProviders;
                renderAdminProviders();
                renderPermanentProviders(); // New: Renders permanent buttons
            }

            function saveProviders() {
                localStorage.setItem('paymentProviders', JSON.stringify(providers));
                renderAdminProviders();
                renderPermanentProviders(); // New: Renders permanent buttons
            }
            
            function renderPermanentProviders() {
                permanentProvidersList.innerHTML = '';
                if (providers.length === 0) {
                    permanentProvidersList.innerHTML = '<p class="text-gray-400 text-center col-span-full">No permanent payment options available. Please check back later.</p>';
                    return;
                }
                
                providers.forEach(provider => {
                    const providerBtn = document.createElement('button');
                    providerBtn.classList.add('w-full', 'py-3', 'btn-blue', 'action-button');
                    providerBtn.dataset.link = provider.link;
                    providerBtn.innerHTML = `${provider.name} <i class="fas fa-copy ml-2"></i>`;
                    providerBtn.addEventListener('click', async (event) => {
                        const link = event.target.closest('button').dataset.link;
                        try {
                            await navigator.clipboard.writeText(link);
                            alert(`${provider.name} payment link copied to clipboard!`);
                        } catch (err) {
                            console.error('Failed to copy text: ', err);
                            alert("Failed to copy link. Please try again.");
                        }
                    });
                    permanentProvidersList.appendChild(providerBtn);
                });
            }

            function renderMenuItems() {
                menuItemsContainer.innerHTML = '';
                if (menuItems.length === 0) {
                    menuItemsContainer.innerHTML = '<p class="text-gray-400 text-center col-span-2">No menu items available at this time. Please use a product link to add one.</p>';
                    return;
                }
                
                menuItems.forEach(item => {
                    const menuItemCard = document.createElement('div');
                    menuItemCard.classList.add('menu-item-card', 'p-4', 'flex', 'flex-col', 'items-center', 'text-center');
                    
                    menuItemCard.innerHTML = `
                        <div class="h-40 w-full overflow-hidden mb-4">
                            <img src="${item.imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x200/F5EEDF/1A1E26?text=No+Image';" alt="${item.name}" class="h-full w-full object-cover" style="border: none;">
                        </div>
                        <h3 class="text-xl font-bold text-black">${item.name}</h3>
                        <p class="text-sm mb-2 text-gray-400">${item.description}</p>
                        <span class="text-2xl font-extrabold text-green-400 mb-4">$${item.price.toFixed(2)}</span>
                        <button class="add-to-cart-btn w-full py-2 btn-blue action-button" data-item-id="${item.id}">
                            <i class="fas fa-cart-plus mr-2"></i> Add to Cart
                        </button>
                    `;
                    menuItemsContainer.appendChild(menuItemCard);
                });

                document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.dataset.itemId;
                        const itemToAdd = menuItems.find(item => item.id === itemId);
                        if (itemToAdd) {
                            addToOrder(itemToAdd);
                        }
                    });
                });
            }

            function addToOrder(item) {
                const existingItem = currentOrder.find(orderItem => orderItem.id === item.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    currentOrder.push({ ...item, quantity: 1 });
                }
                updateOrderList();
            }

            function updateOrderList() {
                orderList.innerHTML = '';
                let total = 0;
                if (currentOrder.length === 0) {
                    emptyCartMessage.classList.remove('hidden');
                    completeOrderBtn.disabled = true;
                } else {
                    emptyCartMessage.classList.add('hidden');
                    completeOrderBtn.disabled = false;
                    currentOrder.forEach(item => {
                        total += item.price * item.quantity;
                        const orderItemDiv = document.createElement('div');
                        orderItemDiv.classList.add('flex', 'items-center', 'justify-between', 'py-2', 'px-3');
                        orderItemDiv.style.cssText = "background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;";
                        orderItemDiv.innerHTML = `
                            <div class="flex-1">
                                <span class="font-medium">${item.name}</span>
                                <span class="text-sm"> x${item.quantity}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="font-semibold text-green-400">$${(item.price * item.quantity).toFixed(2)}</span>
                                <button class="remove-item-btn text-red-400 hover:text-red-500 transition-colors" data-item-id="${item.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        `;
                        orderList.appendChild(orderItemDiv);
                    });
                    document.querySelectorAll('.remove-item-btn').forEach(button => {
                        button.addEventListener('click', (event) => {
                            const itemId = event.target.dataset.itemId;
                            const itemIndex = currentOrder.findIndex(item => item.id === itemId);
                            if (itemIndex > -1) {
                                currentOrder.splice(itemIndex, 1);
                            }
                            updateOrderList();
                        });
                    });
                }
                orderTotalSpan.textContent = `$${total.toFixed(2)}`;
            }

            // Order management for admin dashboard
            let orders = JSON.parse(localStorage.getItem('orders')) || [];

            function saveOrders() {
                localStorage.setItem('orders', JSON.stringify(orders));
                renderAdminOrders();
            }

            function renderAdminOrders() {
                newOrdersListAdmin.innerHTML = '';
                inProgressOrdersListAdmin.innerHTML = '';
                completedOrdersListAdmin.innerHTML = '';
                
                const newOrders = orders.filter(o => o.status === 'pending');
                const inProgressOrders = orders.filter(o => o.status === 'in-progress');
                const completedOrders = orders.filter(o => o.status === 'completed');

                noNewOrders.style.display = newOrders.length === 0 ? 'block' : 'none';
                noInProgressOrders.style.display = inProgressOrders.length === 0 ? 'block' : 'none';
                noCompletedOrders.style.display = completedOrders.length === 0 ? 'block' : 'none';

                newOrders.forEach(order => newOrdersListAdmin.appendChild(createOrderCard(order)));
                inProgressOrders.forEach(order => inProgressOrdersListAdmin.appendChild(createOrderCard(order)));
                completedOrders.forEach(order => completedOrdersListAdmin.appendChild(createOrderCard(order)));
            }

            function createOrderCard(order) {
                const card = document.createElement('div');
                card.classList.add('admin-order-card');
                
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-lg font-bold text-gray-100" style="color: #1A1E26;">Order #${order.orderId}</h4>
                        <span class="text-sm text-gray-400" style="color: #496A6F;">${new Date(order.timestamp).toLocaleTimeString()}</span>
                    </div>
                    <p class="text-sm font-semibold text-yellow-400 mb-1" style="color: #84A28B;">Total: $${order.total.toFixed(2)}</p>
                    <ul class="order-items-list">
                        ${order.items.map(item => `<li>${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}</li>`).join('')}
                    </ul>
                    <div class="status-buttons mt-3 flex justify-end gap-2">
                        ${order.status !== 'in-progress' ? `<button data-order-id="${order.orderId}" data-status="in-progress" class="btn-in-progress">In Progress</button>` : ''}
                        ${order.status !== 'completed' ? `<button data-order-id="${order.orderId}" data-status="completed" class="btn-completed">Completed</button>` : ''}
                        ${order.status === 'completed' ? `<button data-order-id="${order.orderId}" data-status="in-progress" class="btn-revert">Revert</button>` : ''}
                    </div>
                `;

                card.querySelectorAll('.status-buttons button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const orderId = event.target.dataset.orderId;
                        const newStatus = event.target.dataset.status;
                        updateOrderStatus(orderId, newStatus);
                    });
                });
                return card;
            }

            function updateOrderStatus(orderId, newStatus) {
                const orderIndex = orders.findIndex(o => o.orderId == orderId); // Changed to loose comparison to match types
                if (orderIndex > -1) {
                    orders[orderIndex].status = newStatus;
                    saveOrders();
                }
            }
            
            function renderAdminMenuItems() {
                adminMenuList.innerHTML = '';
                productLinkGenerationContainer.innerHTML = '';
                
                if (menuItems.length === 0) {
                    noMenuItemsMessage.style.display = 'block';
                    productLinkGenerationContainer.innerHTML = '<p class="text-gray-400 text-sm text-center">Add a menu item to generate a link.</p>';
                    return;
                }
                noMenuItemsMessage.style.display = 'none';

                menuItems.forEach(item => {
                    // Admin Menu List Item
                    const listItem = document.createElement('div');
                    listItem.classList.add('p-3', 'flex', 'items-center', 'gap-4');
                    listItem.style.cssText = "background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;";
                    listItem.innerHTML = `
                        <img src="${item.imageUrl}" class="w-12 h-12 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/48x48/F5EEDF/1A1E26?text=No+Img';" style="border: 2px solid #000; box-shadow: 2px 2px 0px #000;">
                        <div class="flex-1">
                            <p class="font-bold text-black">${item.name}</p>
                            <p class="text-sm text-gray-400">$${item.price.toFixed(2)}</p>
                        </div>
                        <div class="flex gap-2">
                            <button data-id="${item.id}" class="edit-item-btn" style="color: #496A6F;"><i class="fas fa-edit"></i></button>
                            <button data-id="${item.id}" class="delete-item-btn" style="color: #DE4940;"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    `;
                    adminMenuList.appendChild(listItem);
                    
                    // Product link generation part - MODIFIED to only include product/price
                    const productData = JSON.stringify({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        description: item.description,
                        imageUrl: item.imageUrl
                    });
                    const encodedData = btoa(productData); // Base64 encoding
                    const productLink = `${window.location.origin}${window.location.pathname}?product=${encodedData}`;
                    
                    const linkDiv = document.createElement('div');
                    linkDiv.classList.add('p-3', 'flex', 'flex-col', 'sm:flex-row', 'items-center', 'gap-2');
                    linkDiv.style.cssText = "background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;";
                    linkDiv.innerHTML = `
                        <p class="font-bold text-black">${item.name}:</p>
                        <input type="text" value="${productLink}" readonly class="flex-1 p-1 truncate">
                        <button class="copy-link-btn px-3 py-1 btn-green action-button" data-link="${productLink}" style="font-size: 0.75rem; color: #1A1E26;">Copy</button>
                    `;
                    productLinkGenerationContainer.appendChild(linkDiv);
                });

                document.querySelectorAll('.edit-item-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.closest('button').dataset.id;
                        editItem(itemId);
                    });
                });

                document.querySelectorAll('.delete-item-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.closest('button').dataset.id;
                        deleteItem(itemId);
                    });
                });

                document.querySelectorAll('.copy-link-btn').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const link = event.target.dataset.link;
                        try {
                            await navigator.clipboard.writeText(link);
                            alert("Product link copied to clipboard!");
                        } catch (err) {
                            console.error('Failed to copy text: ', err);
                            alert("Failed to copy link. Please try again.");
                        }
                    });
                });
            }

            function resetItemForm() {
                itemIdInput.value = '';
                itemNameInput.value = '';
                itemPriceInput.value = '';
                itemDescriptionInput.value = '';
                itemImageUrlInput.value = '';
                imagePreview.classList.add('hidden');
                imagePreview.querySelector('img').src = '';
                itemFormTitle.textContent = 'Add New Menu Item';
                saveItemBtn.innerHTML = '<i class="fas fa-plus mr-2"></i> Add Item';
                cancelEditBtn.classList.add('hidden');
                itemFormMessage.classList.add('hidden');
            }

            function editItem(id) {
                const item = menuItems.find(i => i.id === id);
                if (item) {
                    itemIdInput.value = item.id;
                    itemNameInput.value = item.name;
                    itemPriceInput.value = item.price;
                    itemDescriptionInput.value = item.description;
                    itemImageUrlInput.value = item.imageUrl;
                    
                    itemFormTitle.textContent = `Editing: ${item.name}`;
                    saveItemBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Update Item';
                    cancelEditBtn.classList.remove('hidden');
                    
                    if (item.imageUrl) {
                        imagePreview.querySelector('img').src = item.imageUrl;
                        imagePreview.classList.remove('hidden');
                    } else {
                        imagePreview.classList.add('hidden');
                    }
                }
            }

            function deleteItem(id) {
                if (confirm('Are you sure you want to delete this menu item?')) {
                    menuItems = menuItems.filter(item => item.id !== id);
                    saveMenuItems();
                    resetItemForm();
                }
            }
            
            saveItemBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const name = itemNameInput.value.trim();
                const price = parseFloat(itemPriceInput.value);
                const description = itemDescriptionInput.value.trim();
                let imageUrl = itemImageUrlInput.value.trim();

                if (!name || isNaN(price) || !description) {
                    itemFormMessage.textContent = "Please fill in all required fields.";
                    itemFormMessage.classList.remove('hidden');
                    return;
                }
                
                if (!imageUrl) {
                    imageUrl = 'https://placehold.co/400x200/F5EEDF/1A1E26?text=No+Image';
                }
                
                const id = itemIdInput.value || Date.now().toString();
                const existingItemIndex = menuItems.findIndex(item => item.id === id);
                
                if (existingItemIndex > -1) {
                    menuItems[existingItemIndex] = { id, name, price, description, imageUrl };
                } else {
                    menuItems.push({ id, name, price, description, imageUrl });
                }
                saveMenuItems();
                resetItemForm();
            });

            cancelEditBtn.addEventListener('click', resetItemForm);
            
            // Payment Providers Logic
            function renderAdminProviders() {
                providersList.innerHTML = '';
                if (providers.length === 0) {
                    noProvidersMessage.style.display = 'block';
                    return;
                }
                noProvidersMessage.style.display = 'none';

                providers.forEach(provider => {
                    const listItem = document.createElement('div');
                    listItem.classList.add('p-3', 'flex', 'items-center', 'justify-between', 'gap-4');
                    listItem.style.cssText = "background-color: #F5EEDF; border: 2px solid #000; box-shadow: inset 2px 2px 0px #1A1E26; color: #1A1E26;";
                    listItem.innerHTML = `
                        <div class="flex-1">
                            <p class="font-bold">${provider.name}</p>
                            <a href="${provider.link}" target="_blank" class="text-sm text-blue-400 hover:underline truncate" style="color: #496A6F;">${provider.link}</a>
                        </div>
                        <button data-id="${provider.id}" class="delete-provider-btn" style="color: #DE4940;"><i class="fas fa-trash-alt"></i></button>
                    `;
                    providersList.appendChild(listItem);
                });

                document.querySelectorAll('.delete-provider-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const providerId = event.target.closest('button').dataset.id;
                        deleteProvider(providerId);
                    });
                });
            }

            function deleteProvider(id) {
                if (confirm('Are you sure you want to delete this payment provider?')) {
                    providers = providers.filter(p => p.id !== id);
                    saveProviders();
                }
            }

            addProviderBtn.addEventListener('click', () => {
                const name = providerNameInput.value.trim();
                const link = providerLinkInput.value.trim();

                if (name && link) {
                    if (providers.length < 50) {
                        const newProvider = { id: Date.now().toString(), name, link };
                        providers.push(newProvider);
                        saveProviders();
                        providerNameInput.value = '';
                        providerLinkInput.value = '';
                        providerFormMessage.classList.add('hidden');
                    } else {
                        providerFormMessage.textContent = "You have reached the maximum of 50 payment providers.";
                        providerFormMessage.classList.remove('hidden');
                    }
                } else {
                    providerFormMessage.textContent = "Please enter both a provider name and a payment link.";
                    providerFormMessage.classList.remove('hidden');
                }
            });

            // Event Listeners
            showKioskBtn.addEventListener('click', () => {
                showPage('food-kiosk-page');
            });
            
            showAdminBtn.addEventListener('click', () => {
                showPage('admin-dashboard-page');
            });

            backToStartKioskBtn.addEventListener('click', () => {
                showPage('start-page');
            });

            backToStartAdminBtn.addEventListener('click', () => {
                showPage('start-page');
            });

            adminLoginSubmitBtn.addEventListener('click', () => {
                const currentAdminPin = localStorage.getItem('adminPIN') || ADMIN_PIN;
                if (adminPinInput.value === currentAdminPin) {
                    document.getElementById('admin-login-section').classList.add('hidden');
                    adminDashboardContent.classList.remove('hidden');
                    renderAdminOrders();
                    loadProviders(); 
                    loadMenuItems(); 
                    storeTitleInput.value = localStorage.getItem('storeTitle') || "";
                    storeTaglineInput.value = localStorage.getItem('storeTagline') || "";
                    menuTitleInput.value = localStorage.getItem('menuTitle') || "";
                } else {
                    adminLoginMessage.classList.remove('hidden');
                }
            });
            
            completeOrderBtn.addEventListener('click', () => {
                if (currentOrder.length > 0) {
                    const total = currentOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);
                    const orderId = Date.now();
                    
                    orders.push({ orderId, items: currentOrder, total, status: 'pending', timestamp: new Date() });
                    saveOrders();
                    
                    currentOrder = [];
                    updateOrderList();
                    showPage('order-menu-page');
                    transactionNumberSpan.textContent = orderId;
                }
            });

            startNewOrderBtn.addEventListener('click', () => {
                showPage('food-kiosk-page');
            });
            
            updatePinBtn.addEventListener('click', () => {
                const currentPin = currentPinInput.value;
                const newPin = newPinInput.value;
                const confirmNewPin = confirmNewPinInput.value;
            
                const currentAdminPin = localStorage.getItem('adminPIN') || ADMIN_PIN;

                if (currentPin !== currentAdminPin) {
                    pinMessage.textContent = "Incorrect current PIN.";
                    pinMessage.classList.remove('hidden');
                    pinMessage.style.color = '#DE4940';
                    return;
                }

                if (newPin.length !== 15) {
                    pinMessage.textContent = "New PIN must be 15 digits long.";
                    pinMessage.classList.remove('hidden');
                    pinMessage.style.color = '#DE4940';
                    return;
                }
                
                if (newPin !== confirmNewPin) {
                    pinMessage.textContent = "New PIN and confirmation do not match.";
                    pinMessage.classList.remove('hidden');
                    pinMessage.style.color = '#DE4940';
                    return;
                }
                
                if (newPin === currentAdminPin) {
                    pinMessage.textContent = "New PIN cannot be the same as the current PIN.";
                    pinMessage.classList.remove('hidden');
                    pinMessage.style.color = '#DE4940';
                    return;
                }

                localStorage.setItem('adminPIN', newPin);
                pinMessage.textContent = "PIN updated successfully!";
                pinMessage.classList.remove('hidden');
                pinMessage.style.color = '#84A28B';
                
                currentPinInput.value = '';
                newPinInput.value = '';
                confirmNewPinInput.value = '';
            });
            
            // This function handles the "unwrapping" of the product link.
            loadProductLinkBtn.addEventListener('click', () => {
                const link = productLinkInput.value.trim();
                if (!link) {
                    productLinkMessage.textContent = "Please paste a link to load a product.";
                    productLinkMessage.classList.remove('hidden');
                    return;
                }

                try {
                    const url = new URL(link);
                    const encodedData = url.searchParams.get('product');

                    if (encodedData) {
                        const decodedData = atob(encodedData);
                        const product = JSON.parse(decodedData);
                        
                        // Add the product to the main menu items list
                        const existingProductIndex = menuItems.findIndex(item => item.id === product.id);
                        if (existingProductIndex === -1) {
                            menuItems.push(product);
                            saveMenuItems();
                        } else {
                            // Update existing product if ID matches
                            menuItems[existingProductIndex] = product;
                            saveMenuItems();
                        }
                        
                        alert("Product loaded successfully!");
                        productLinkInput.value = '';
                        productLinkMessage.classList.add('hidden');
                    } else {
                        productLinkMessage.textContent = "Invalid product link. The link must contain 'product' data.";
                        productLinkMessage.classList.remove('hidden');
                    }
                } catch (e) {
                    productLinkMessage.textContent = "Invalid URL format.";
                    productLinkMessage.classList.remove('hidden');
                }
            });
            
            // This event listener automatically unwraps the link if the page is loaded with a product parameter.
            window.addEventListener('load', () => {
                const urlParams = new URLSearchParams(window.location.search);
                const encodedData = urlParams.get('product');
                if (encodedData) {
                    try {
                        const decodedData = atob(encodedData);
                        const product = JSON.parse(decodedData);
                        
                        // Add the product to the main menu items list
                        const existingProductIndex = menuItems.findIndex(item => item.id === product.id);
                        if (existingProductIndex === -1) {
                            menuItems.push(product);
                            saveMenuItems();
                        } else {
                            // Update existing product if ID matches
                            menuItems[existingProductIndex] = product;
                            saveMenuItems();
                        }
                        showPage('food-kiosk-page');
                    } catch (e) {
                        console.error("Failed to decode product data from URL:", e);
                    }
                }
            });

            storeTitleInput.addEventListener('input', (e) => {
                localStorage.setItem('storeTitle', e.target.value);
                updateKioskText();
            });

            storeTaglineInput.addEventListener('input', (e) => {
                localStorage.setItem('storeTagline', e.target.value);
                updateKioskText();
            });

            menuTitleInput.addEventListener('input', (e) => {
                localStorage.setItem('menuTitle', e.target.value);
                updateKioskText();
            });

            clearOrdersBtn.addEventListener('click', () => {
                confirmationModal.style.display = "flex";
            });

            confirmYesBtn.addEventListener('click', () => {
                orders = [];
                saveOrders();
                confirmationModal.style.display = "none";
            });

            confirmNoBtn.addEventListener('click', () => {
                confirmationModal.style.display = "none";
            });

            closeConfirmModal.addEventListener('click', () => {
                confirmationModal.style.display = "none";
            });

            saveCompletedOrdersBtn.addEventListener('click', async () => {
                const completedOrders = orders.filter(o => o.status === 'completed');
                if (completedOrders.length === 0) {
                    alert("No completed orders to save.");
                    return;
                }
                const completedOrdersText = completedOrders.map(order => {
                    const items = order.items.map(item => `  - ${item.name} (x${item.quantity})`).join('\n');
                    return `Order #${order.orderId} - Total: $${order.total.toFixed(2)}\nItems:\n${items}\nTimestamp: ${new Date(order.timestamp).toLocaleString()}\n`;
                }).join('\n' + '-'.repeat(30) + '\n');
                
                try {
                    await navigator.clipboard.writeText(completedOrdersText);
                    alert("Completed orders copied to clipboard!");
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    alert("Failed to copy orders to clipboard. Please try again.");
                }
            });

            copyTransactionBtn.addEventListener('click', async () => {
                const transactionNumber = transactionNumberSpan.textContent;
                try {
                    await navigator.clipboard.writeText(transactionNumber);
                    alert("Transaction number copied to clipboard!");
                } catch (err) {
                    console.error('Failed to copy transaction number: ', err);
                    alert("Failed to copy transaction number. Please try again.");
                }
            });

            if (typeof window.ethereum !== 'undefined') {
                connectMetamaskBtn.addEventListener('click', async () => {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const account = accounts[0];
                        alert(`Successfully connected to MetaMask! Account: ${account}`);
                    } catch (error) {
                    }
                });
            } else {
                connectMetamaskBtn.classList.add('hidden');
            }

            updateKioskText();
            loadProviders();
        });
    </script>
</body>
</html>
